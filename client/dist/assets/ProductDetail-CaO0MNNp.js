import{j as e,m,d as le,e as D,Z as ce,f as B,g as oe,X as de,a as me,h as xe,i as v,k as w}from"./ui-B5PjYYeE.js";import{h as he,b as ge,r as o,L as x}from"./vendor-qOmVjXE-.js";import{b as ue,u as C,c as Z,d as ye}from"./index-DBuhCPqP.js";import{g as pe}from"./productService-rVeuLpxN.js";import{a as fe}from"./featuredProductService-uRl-Kk3A.js";import{a as je}from"./newArrivalService-CXfNQ85O.js";import{f as F}from"./formatCurrency-mEhBIXkX.js";const Se=()=>{var q,O,_;const{id:l}=he(),N=ge(),y=N.pathname.startsWith("/new-arrivals/"),p=((q=N.state)==null?void 0:q.fromCategory)===!0,[k,K]=o.useState(0),[d,z]=o.useState({description:!0,specifications:!1,features:!1,reviews:!1}),[u,I]=o.useState(!1),[R,T]=o.useState({x:0,y:0}),f=o.useRef(null),{addToCart:W}=ue(),[j,$]=o.useState(1),[i,H]=o.useState(y),{data:r,isLoading:X,error:S}=C({queryKey:["product",l],queryFn:async()=>{try{return await pe(l)}catch(t){throw t}},retry:1,enabled:!y||p,onError:t=>{}}),{data:h,isLoading:G}=C({queryKey:["featuredProduct",l],queryFn:async()=>{try{return await fe(l)}catch(t){throw t}},enabled:!!r,retry:!1,onError:t=>{},meta:{hideFromConsole:!0}}),Q=h?{...r,...h,name:h.featuredTitle||(r==null?void 0:r.name),description:h.featuredDescription||(r==null?void 0:r.description),image:h.featuredImage||(r==null?void 0:r.image),galleryImages:h.featuredGalleryImages||(r==null?void 0:r.galleryImages)}:r;o.useEffect(()=>{window.scrollTo({top:0,behavior:"smooth"})},[]);const{data:Y,isLoading:J,error:V}=C({queryKey:["newArrival",l],queryFn:async()=>{try{return await je(l)}catch(t){throw t}},enabled:i||y,retry:1,onError:t=>{}}),s=i?Y:Q,U=(i?J:X)||G,c=i?V:S;o.useEffect(()=>{S&&!i&&!y&&(p||H(!0))},[S,i,y,l,p]);const{data:P}=C({queryKey:["relatedProducts",l,s==null?void 0:s.category],queryFn:async()=>s!=null&&s.category?(await ye.get(`/products/category/${encodeURIComponent(s.category)}`)).data.filter(a=>a._id!==l).slice(0,4):[],enabled:!!(s!=null&&s.category)}),ee=()=>{if(!s)return;if(!i&&s.countInStock===0){Z.error("This item is out of stock");return}const t=!!h,a={...s,isNewArrival:i,isFeatured:t,type:t?"featured":i?"newArrival":"product"};if(t&&r&&r._id){const n=typeof r._id=="object"?r._id._id:r._id;a.productId=n}W(a,j),Z.success("Added to cart")},b=t=>{z(a=>({...a,[t]:!a[t]}))},se=t=>{if(!f.current||!u)return;const{left:a,top:n,width:M,height:A}=f.current.getBoundingClientRect(),E=Math.min(Math.max((t.clientX-a)/M,0),1),L=Math.min(Math.max((t.clientY-n)/A,0),1);T({x:E,y:L})},te=t=>{if(!f.current||!u)return;t.preventDefault();const a=t.touches[0],{left:n,top:M,width:A,height:E}=f.current.getBoundingClientRect(),L=Math.min(Math.max((a.clientX-n)/A,0),1),ne=Math.min(Math.max((a.clientY-M)/E,0),1);T({x:L,y:ne})},ae=()=>{g&&g[k]&&I(!0)},re=()=>{I(!1)},ie=()=>{I(!u)};if(U)return e.jsx(m.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-[#39b54a]"})});if(c||!s){const t=c&&(c.isDbConnectionError||c.message&&c.message.toLowerCase().includes("service unavailable")||c.response&&c.response.status===503);return e.jsx(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-red-600 mb-4",children:t?"Temporary Service Unavailable":"Item Not Found"}),t?e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 mb-6",children:"We're experiencing temporary database connectivity issues. The server is running, but can't connect to the database at the moment."}),e.jsxs("p",{className:"text-gray-500 mb-4",children:["This is often resolved quickly. Please try:",e.jsxs("ul",{className:"list-disc mt-2 text-left max-w-md mx-auto",children:[e.jsx("li",{children:"Refreshing the page"}),e.jsx("li",{children:"Coming back in a few minutes"}),e.jsx("li",{children:"Checking if other products are accessible"})]})]}),e.jsx("button",{onClick:()=>window.location.reload(),className:"inline-flex items-center px-4 py-2 bg-[#39b54a] text-white rounded-lg hover:bg-[#2d8f3a] transition-colors mr-4",children:"Retry Now"}),e.jsx(x,{to:"/products",className:"inline-flex items-center px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:"Browse Other Products"})]}):e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 mb-6",children:i&&!p?"This item is not available in New Arrivals. It may have been moved to regular products.":p?"The product you're looking for could not be found in this category.":c&&c.message||"The item you're looking for doesn't exist or has been removed."}),e.jsxs("p",{className:"text-gray-500 mb-4",children:["This could be due to one of the following reasons:",e.jsxs("ul",{className:"list-disc mt-2 text-left max-w-md mx-auto",children:[e.jsx("li",{children:"The product ID is incorrect"}),e.jsx("li",{children:"The product has been moved to a different category"}),e.jsx("li",{children:"The product has been deleted"}),e.jsx("li",{children:"There's a temporary database connection issue"})]})]}),e.jsxs("div",{className:"flex gap-4 justify-center mt-6",children:[e.jsxs(x,{to:"/products",className:"inline-flex items-center px-4 py-2 bg-[#39b54a] text-white rounded-lg hover:bg-[#2d8f3a] transition-colors",children:[e.jsx(le,{className:"mr-2",size:18}),"Browse Products"]}),e.jsx(x,{to:"/",className:"inline-flex items-center px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:"Go to Home"})]})]}),!1]})})}const g=[s.image];return s.galleryImages&&(Array.isArray(s.galleryImages)?g.push(...s.galleryImages.map(t=>t.url)):g.push(...s.galleryImages)),e.jsx(m.div,{initial:{opacity:0,x:((O=N.state)==null?void 0:O.transition)==="slide"?50:0},animate:{opacity:1,x:0},exit:{opacity:0,x:((_=N.state)==null?void 0:_.transition)==="slide"?-50:0},transition:{duration:.3,ease:"easeOut"},children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("nav",{className:"mb-8",children:e.jsxs("ol",{className:"flex items-center space-x-2 text-sm",children:[e.jsx("li",{children:e.jsx(x,{to:"/",className:"text-gray-500 hover:text-gray-700",children:"Home"})}),e.jsxs("li",{className:"flex items-center",children:[e.jsx(D,{className:"h-4 w-4 text-gray-400"}),e.jsx(x,{to:"/products",className:"ml-2 text-gray-500 hover:text-gray-700",children:"Products"})]}),s.category&&e.jsxs("li",{className:"flex items-center",children:[e.jsx(D,{className:"h-4 w-4 text-gray-400"}),e.jsx(x,{to:`/products?category=${s.category}`,className:"ml-2 text-gray-500 hover:text-gray-700",children:s.category})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx(D,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"ml-2 text-gray-900 truncate max-w-xs",children:s.name})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("div",{ref:f,className:"relative aspect-square bg-white rounded-lg overflow-hidden border border-gray-200",onMouseMove:se,onMouseEnter:ae,onMouseLeave:re,onTouchMove:te,onClick:ie,children:[e.jsx("img",{src:g[k],alt:s.name,className:`w-full h-full object-contain p-4 transition-all duration-300 ${u?"scale-150":"scale-100"}`,style:u?{transformOrigin:`${R.x*100}% ${R.y*100}%`,cursor:"zoom-out"}:{cursor:"zoom-in"}}),u&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsx(ce,{className:"h-8 w-8 text-gray-400 opacity-50"})})]}),g.length>1&&e.jsx("div",{className:"mt-4 grid grid-cols-5 gap-2",children:g.map((t,a)=>e.jsx("button",{onClick:()=>K(a),className:`relative aspect-square rounded-md overflow-hidden border ${k===a?"border-[#39b54a] ring-2 ring-[#39b54a]":"border-gray-200"}`,children:e.jsx("img",{src:t,alt:`${s.name} ${a+1}`,className:"w-full h-full object-contain p-1",onError:n=>{n.target.src="https://placehold.co/400x400?text=No+Image"}})},a))})]}),e.jsxs("div",{children:[e.jsxs(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:s.name}),s.brand&&e.jsxs("div",{className:"mt-2 flex items-center",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Brand: "}),e.jsx(x,{to:`/brand/${s.brand}`,className:"ml-1 text-sm font-medium text-[#39b54a] hover:underline",children:s.brand})]})]}),s.rating&&e.jsx(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"mt-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex",children:[1,2,3,4,5].map(t=>e.jsx(B,{className:`h-5 w-5 ${t<Math.floor(s.rating)?"text-yellow-400":"text-gray-300"}`,fill:t<=Math.floor(s.rating)?"currentColor":"none"},t))}),e.jsxs("p",{className:"ml-2 text-sm text-gray-500",children:[s.rating.toFixed(1)," out of 5"]}),s.numReviews&&e.jsxs("p",{className:"ml-2 text-sm text-gray-500",children:["(",s.numReviews," reviews)"]})]})}),e.jsxs(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"mt-4",children:[e.jsxs("div",{className:"flex items-baseline",children:[e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:F(s.price)}),s.originalPrice&&s.originalPrice>s.price&&e.jsx("p",{className:"text-lg text-gray-500 line-through ml-2",children:F(s.originalPrice)})]}),s.originalPrice&&e.jsxs("p",{className:"mt-1 text-sm text-green-600",children:["Save $",(s.originalPrice-s.price).toFixed(2)," (",Math.round((1-s.price/s.originalPrice)*100),"% off)"]})]}),!i&&e.jsx("div",{className:"mt-4",children:s.countInStock>0?e.jsxs("div",{className:"flex items-center text-green-600",children:[e.jsx(oe,{className:"h-5 w-5 mr-1"}),e.jsx("span",{children:"In Stock"}),s.countInStock<10&&e.jsxs("span",{className:"ml-2 text-sm text-orange-600",children:["(Only ",s.countInStock," left)"]})]}):e.jsxs("div",{className:"flex items-center text-red-600",children:[e.jsx(de,{className:"h-5 w-5 mr-1"}),e.jsx("span",{children:"Out of Stock"})]})}),e.jsxs(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"mt-6",children:[(s.sku||s.modelNumber)&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[s.sku&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"SKU:"}),e.jsx("span",{className:"ml-2 font-medium",children:s.sku})]}),s.modelNumber&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Model:"}),e.jsx("span",{className:"ml-2 font-medium",children:s.modelNumber})]})]}),e.jsxs("div",{className:"mt-6 flex space-x-4",children:[e.jsxs("div",{className:"flex items-center border border-gray-300 rounded-md",children:[e.jsx("button",{onClick:()=>$(Math.max(1,j-1)),className:"px-3 py-2 text-gray-600 hover:text-gray-900",disabled:j<=1,children:"-"}),e.jsx("span",{className:"px-3 py-2 border-x border-gray-300",children:j}),e.jsx("button",{onClick:()=>$(j+1),className:"px-3 py-2 text-gray-600 hover:text-gray-900",children:"+"})]}),e.jsxs("button",{onClick:ee,disabled:!i&&s.countInStock===0,className:"flex-1 bg-[#39b54a] text-white px-6 py-3 rounded-md hover:bg-[#2d8f3a] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#39b54a] disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:[e.jsx(me,{className:"h-5 w-5 mr-2"}),!i&&s.countInStock===0?"Out of Stock":"Add to Cart"]}),e.jsx("button",{className:"p-3 border border-gray-300 rounded-md hover:bg-gray-50","aria-label":"Add to wishlist",children:e.jsx(xe,{className:"h-5 w-5 text-gray-600"})})]})]}),e.jsxs(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"mt-8",children:[e.jsxs("div",{className:"border-b border-gray-200",children:[e.jsxs("button",{onClick:()=>b("description"),className:"flex justify-between items-center w-full py-4 text-left",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Description"}),d.description?e.jsx(v,{className:"h-5 w-5 text-gray-500"}):e.jsx(w,{className:"h-5 w-5 text-gray-500"})]}),d.description&&e.jsxs("div",{className:"pb-4 prose prose-sm max-w-none",children:[e.jsx("p",{className:"text-gray-600",children:s.description}),s.detailedDescription&&e.jsx("div",{className:"mt-4 text-gray-600 whitespace-pre-line",children:s.detailedDescription})]})]}),s.features&&s.features.length>0&&e.jsxs("div",{className:"border-b border-gray-200",children:[e.jsxs("button",{onClick:()=>b("features"),className:"flex justify-between items-center w-full py-4 text-left",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Features"}),d.features?e.jsx(v,{className:"h-5 w-5 text-gray-500"}):e.jsx(w,{className:"h-5 w-5 text-gray-500"})]}),d.features&&e.jsx("div",{className:"pb-4",children:e.jsx("ul",{className:"list-disc pl-5 space-y-2",children:s.features.map((t,a)=>e.jsx("li",{className:"text-gray-600",children:t},a))})})]}),(s.technicalSpecs||s.specifications||s.dimensions||s.weight||s.warranty)&&e.jsxs("div",{className:"border-b border-gray-200",children:[e.jsxs("button",{onClick:()=>b("specifications"),className:"flex justify-between items-center w-full py-4 text-left",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Specifications"}),d.specifications?e.jsx(v,{className:"h-5 w-5 text-gray-500"}):e.jsx(w,{className:"h-5 w-5 text-gray-500"})]}),d.specifications&&e.jsx("div",{className:"pb-4",children:e.jsxs("dl",{className:"grid grid-cols-1 gap-x-4 gap-y-4 sm:grid-cols-2",children:[s.technicalSpecs&&Object.entries(s.technicalSpecs).map(([t,a])=>e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:t}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900",children:a})]},t)),s.specifications&&Object.entries(s.specifications).map(([t,a])=>e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:t}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900",children:a})]},t)),s.dimensions&&e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Dimensions"}),e.jsxs("dd",{className:"mt-1 text-sm text-gray-900",children:[s.dimensions.length," x ",s.dimensions.width," x ",s.dimensions.height," ",s.dimensions.unit]})]}),s.weight&&e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Weight"}),e.jsxs("dd",{className:"mt-1 text-sm text-gray-900",children:[s.weight.value," ",s.weight.unit]})]}),s.warranty&&e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Warranty"}),e.jsxs("dd",{className:"mt-1 text-sm text-gray-900",children:[s.warranty.duration," ",s.warranty.unit,s.warranty.description&&e.jsx("span",{className:"block text-gray-500",children:s.warranty.description})]})]})]})})]}),s.reviews&&s.reviews.length>0&&e.jsxs("div",{className:"border-b border-gray-200",children:[e.jsxs("button",{onClick:()=>b("reviews"),className:"flex justify-between items-center w-full py-4 text-left",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Reviews"}),d.reviews?e.jsx(v,{className:"h-5 w-5 text-gray-500"}):e.jsx(w,{className:"h-5 w-5 text-gray-500"})]}),d.reviews&&e.jsx("div",{className:"pb-4",children:s.reviews&&s.reviews.length>0?e.jsx("div",{className:"space-y-6",children:s.reviews.map((t,a)=>e.jsxs("div",{className:"border-b border-gray-100 pb-4 last:border-0 last:pb-0",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex",children:[1,2,3,4,5].map(n=>e.jsx(B,{className:`h-4 w-4 ${n<=t.rating?"text-yellow-400":"text-gray-300"}`,fill:n<=t.rating?"currentColor":"none"},n))}),e.jsx("span",{className:"ml-2 text-sm font-medium text-gray-900",children:t.name}),e.jsx("span",{className:"ml-2 text-sm text-gray-500",children:new Date(t.createdAt).toLocaleDateString()})]}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:t.comment})]},a))}):e.jsx("p",{className:"text-sm text-gray-500",children:"No reviews yet."})})]})]})]})]}),P&&P.length>0&&e.jsxs("div",{className:"mt-16",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Related Products"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6",children:P.map(t=>e.jsx(x,{to:`/products/${t._id}`,className:"group block",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden transition-shadow duration-300 hover:shadow-lg h-full flex flex-col",children:[e.jsx("div",{className:"h-48 overflow-hidden",children:e.jsx("img",{src:t.image,alt:t.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"})}),e.jsxs("div",{className:"p-4 flex-1 flex flex-col",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 group-hover:text-[#39b54a] transition-colors line-clamp-1",children:t.name}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 line-clamp-2 flex-1",children:t.description}),e.jsx("p",{className:"mt-2 text-lg font-semibold",children:F(t.price)})]})]})},t._id))})]})]})})};export{Se as default};
