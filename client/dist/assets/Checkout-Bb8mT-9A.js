import{j as e,p as _,q as E}from"./ui-B5PjYYeE.js";import{u as R,r as x}from"./vendor-qOmVjXE-.js";import{b as B,e as D,u as w,V as i}from"./index-DBuhCPqP.js";import{B as $}from"./Button-BWQtias1.js";import{c as z}from"./orderService-DscCu6l1.js";import{g as k}from"./settingService-BkbaxgG5.js";import{F as K}from"./XMarkIcon-xrA3YfBf.js";import{f as g}from"./formatCurrency-mEhBIXkX.js";const M=({contactInfo:s,onClose:n})=>e.jsx("div",{className:"fixed inset-0 bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4 relative",children:[e.jsx("button",{onClick:n,className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600",children:e.jsx(K,{className:"h-6 w-6"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Orders Currently Not Accepted"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"We apologize, but we are currently not accepting online orders. Please contact us through one of the following channels:"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("a",{href:s==null?void 0:s.telegram,target:"_blank",rel:"noopener noreferrer",className:"block w-full py-2 px-4 bg-[#0088cc] text-white rounded-md hover:bg-[#006699] transition-colors",children:"Contact via Telegram"}),e.jsx("a",{href:s==null?void 0:s.facebook,target:"_blank",rel:"noopener noreferrer",className:"block w-full py-2 px-4 bg-[#1877f2] text-white rounded-md hover:bg-[#166fe5] transition-colors",children:"Contact via Facebook"}),e.jsxs("a",{href:`tel:${s==null?void 0:s.phone}`,className:"block w-full py-2 px-4 bg-gray-800 text-white rounded-md hover:bg-gray-700 transition-colors",children:["Call us: ",s==null?void 0:s.phone]}),e.jsxs("a",{href:`mailto:${s==null?void 0:s.email}`,className:"block w-full py-2 px-4 bg-gray-800 text-white rounded-md hover:bg-gray-700 transition-colors",children:["Email us: ",s==null?void 0:s.email]})]})]})]})}),Y=()=>{const s=R(),{cartItems:n,clearCart:C,validateCart:Q}=B(),{user:l}=D(),[q,f]=x.useState(!1),[u,m]=x.useState(""),[r,F]=x.useState({fullName:(l==null?void 0:l.name)||"",email:(l==null?void 0:l.email)||"",phone:"",address:"",city:"",state:"",additionalInfo:""}),[O,y]=x.useState(!1),{data:N}=w({queryKey:["setting","acceptOrders"],queryFn:()=>k("acceptOrders")}),{data:p}=w({queryKey:["setting","contactInfo"],queryFn:()=>k("contactInfo")});x.useEffect(()=>{if(!l){s("/login",{state:{from:"/checkout"}});return}n.length===0&&s("/cart")},[l,n,s]);const o=t=>{const{name:c,value:h}=t.target;F(d=>({...d,[c]:h}))},P=()=>N&&N.value===!1?(y(!0),!1):!l||!l._id?(i.error("Please log in to complete your order"),s("/login",{state:{from:"/checkout"}}),!1):u?!r.fullName||!r.email||!r.phone||!r.address||!r.city||!r.state?(i.error("Please fill in all required fields"),!1):/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r.email)?r.phone.length<10?(i.error("Please enter a valid phone number"),!1):!0:(i.error("Please enter a valid email address"),!1):(i.error("Please select a payment method"),!1),S=async t=>{var c,h;if(t.preventDefault(),!!P()){f(!0);try{const T={items:n.map(a=>(a.isFeatured||a.type==="featured")&&a.actualProductId?{product:a._id,productId:a.actualProductId,productType:"featuredProduct",quantity:a.quantity,price:a.price,name:a.name||a.title}:a.isNewArrival||a.type==="newArrival"?{product:a._id,productType:"newArrival",quantity:a.quantity,price:a.price,name:a.name||a.title}:{product:a._id,productType:"product",quantity:a.quantity,price:a.price,name:a.name||a.title}),shippingDetails:{fullName:r.fullName,email:r.email,phoneNumber:r.phone,address:r.address},paymentMethod:u,totalAmount:n.reduce((a,v)=>a+v.price*v.quantity,0)};await z(T),C(),i.success("Order placed successfully!"),setTimeout(()=>{s("/order-success",{state:{from:"checkout"}})},1e3)}catch(d){(h=(c=d.details)==null?void 0:c.data)!=null&&h.message&&d.details.data.message.includes("not found")?(i.error("One or more products in your cart are no longer available. Please update your cart."),s("/cart")):d.message&&d.message.includes("Authentication required")?(i.error("Please log in to complete your order"),s("/login",{state:{from:"/checkout"}})):d.code==="NOT_FOUND_ERROR"?i.error("Order service unavailable. Please try again later or contact support."):i.error(d.message||"Failed to place order")}finally{f(!1)}}},b=n.reduce((t,c)=>t+c.price*c.quantity,0),j=b>0?10:0,A=b+j;return e.jsxs("div",{className:"min-h-screen bg-gray-50 pt-24",children:[e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-8",children:"Checkout"}),e.jsxs("div",{className:"lg:grid lg:grid-cols-12 lg:gap-x-12",children:[e.jsx("div",{className:"lg:col-span-7",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Shipping Address"}),e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"fullName",className:"block text-sm font-medium text-gray-700",children:["Full Name ",e.jsx("span",{className:"text-green-500",children:"*"})]}),e.jsx("input",{type:"text",id:"fullName",name:"fullName",value:r.fullName,onChange:o,required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#39b54a] focus:ring-[#39b54a]"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:["Email ",e.jsx("span",{className:"text-green-500",children:"*"})]}),e.jsx("input",{type:"email",id:"email",name:"email",value:r.email,onChange:o,required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#39b54a] focus:ring-[#39b54a]"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700",children:["Phone Number ",e.jsx("span",{className:"text-green-500",children:"*"})]}),e.jsx("input",{type:"tel",id:"phone",name:"phone",value:r.phone,onChange:o,required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#39b54a] focus:ring-[#39b54a]"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"address",className:"block text-sm font-medium text-gray-700",children:["Street Address ",e.jsx("span",{className:"text-green-500",children:"*"})]}),e.jsx("input",{type:"text",id:"address",name:"address",value:r.address,onChange:o,required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#39b54a] focus:ring-[#39b54a]"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"city",className:"block text-sm font-medium text-gray-700",children:["City ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",id:"city",name:"city",value:r.city,onChange:o,required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#39b54a] focus:ring-[#39b54a]"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"state",className:"block text-sm font-medium text-gray-700",children:["State/Region ",e.jsx("span",{className:"text-green-500",children:"*"})]}),e.jsx("input",{type:"text",id:"state",name:"state",value:r.state,onChange:o,required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#39b54a] focus:ring-[#39b54a]"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"additionalInfo",className:"block text-sm font-medium text-gray-700",children:"Additional Information (Optional)"}),e.jsx("textarea",{id:"additionalInfo",name:"additionalInfo",value:r.additionalInfo,onChange:o,rows:3,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#39b54a] focus:ring-[#39b54a]"})]}),e.jsxs("div",{className:"mt-8",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:["Payment Method ",e.jsx("span",{className:"text-green-500",children:"*"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-4 p-4 border rounded-lg cursor-pointer hover:border-[#39b54a]",onClick:()=>m("telebirr"),children:[e.jsx("input",{type:"radio",name:"payment",checked:u==="telebirr",onChange:()=>m("telebirr"),className:"h-4 w-4 text-[#39b54a] focus:ring-[#39b54a]"}),e.jsx("img",{src:"/images/telebirr-logo.png",alt:"Telebirr",className:"h-8"}),e.jsx("span",{className:"text-sm font-medium",children:"Telebirr"})]}),e.jsxs("div",{className:"flex items-center space-x-4 p-4 border rounded-lg cursor-pointer hover:border-[#39b54a]",onClick:()=>m("abyssinia"),children:[e.jsx("input",{type:"radio",name:"payment",checked:u==="abyssinia",onChange:()=>m("abyssinia"),className:"h-4 w-4 text-[#39b54a] focus:ring-[#39b54a]"}),e.jsx("img",{src:"/images/abyssinia-logo.png",alt:"Bank of Abyssinia",className:"h-8"}),e.jsx("span",{className:"text-sm font-medium",children:"Bank of Abyssinia"})]}),e.jsxs("div",{className:"flex items-center space-x-4 p-4 border rounded-lg cursor-pointer hover:border-[#39b54a]",onClick:()=>m("cbe"),children:[e.jsx("input",{type:"radio",name:"payment",checked:u==="cbe",onChange:()=>m("cbe"),className:"h-4 w-4 text-[#39b54a] focus:ring-[#39b54a]"}),e.jsx("img",{src:"/images/cbe-logo.png",alt:"Commercial Bank of Ethiopia",className:"h-8"}),e.jsx("span",{className:"text-sm font-medium",children:"Commercial Bank of Ethiopia"})]})]})]}),e.jsx("div",{className:"mt-8",children:e.jsx($,{type:"submit",variant:"primary",size:"lg",className:"w-full bg-[#39b54a] hover:bg-[#2d8f3a] text-white font-medium",loading:q,children:"Place Order"})})]})]})}),e.jsx("div",{className:"lg:col-span-5 mt-8 lg:mt-0",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 sticky top-24",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Order Summary"}),e.jsxs("div",{className:"space-y-4",children:[n.map(t=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("img",{src:t.image,alt:t.title||t.name,className:"w-16 h-16 object-cover rounded-lg"}),e.jsxs("div",{className:"ml-4 flex-1",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:t.title||t.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Qty: ",t.quantity]})]}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:g((t.price||0)*t.quantity)})]},t._id)),e.jsxs("div",{className:"border-t border-gray-200 pt-4 space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Subtotal"}),e.jsx("span",{className:"text-gray-900",children:g(b)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Shipping & handling"}),e.jsx("span",{className:"text-gray-900",children:g(j)})]}),e.jsx("div",{className:"border-t border-gray-200 pt-4",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-lg font-medium text-gray-900",children:"Total"}),e.jsx("span",{className:"text-lg font-medium text-gray-900",children:g(A)})]})})]})]}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),"Free shipping on orders over $50"]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),"Secure checkout"]})]})]})})]})]}),O&&e.jsx(M,{contactInfo:p==null?void 0:p.value,onClose:()=>y(!1)})]})};export{Y as default};
