import{j as e}from"./ui-B5PjYYeE.js";import{r as h,u as j,L as p}from"./vendor-qOmVjXE-.js";import{m as w,e as v,c as d,u as b,P as x}from"./index-DBuhCPqP.js";import{u as k}from"./useMutation-MTKIpc2f.js";import{d as A,b as E}from"./newArrivalService-CXfNQ85O.js";const L=(a,l=!1)=>{if(!a)return"N/A";const c=typeof a=="string"?new Date(a):a;if(isNaN(c.getTime()))return"Invalid Date";const r={year:"numeric",month:"short",day:"numeric"};return l&&(r.hour="2-digit",r.minute="2-digit"),c.toLocaleDateString("en-US",r)},I=()=>{const[a,l]=h.useState(!1),c=w(),r=j(),{user:i,loading:o}=v();h.useEffect(()=>{!o&&(!i||i.role!=="admin")&&(d.error("You do not have permission to access this page"),r("/"))},[i,o,r]);const{data:n,isLoading:g,error:f}=b({queryKey:["adminNewArrivals"],queryFn:E,enabled:!!i&&i.role==="admin"&&!o,retry:1,onError:s=>{var t;((t=s.response)==null?void 0:t.status)===401?(d.error("Your session has expired. Please log in again."),r("/login")):d.error("Failed to load new arrivals. Please try again.")}}),y=k({mutationFn:A,onSuccess:()=>{c.invalidateQueries({queryKey:["adminNewArrivals"]}),d.success("New arrival deleted successfully")},onError:s=>{var t,m,u;((t=s.response)==null?void 0:t.status)===401?(d.error("Your session has expired. Please log in again."),r("/login")):d.error(((u=(m=s.response)==null?void 0:m.data)==null?void 0:u.message)||"Error deleting new arrival")}}),N=async s=>{if(window.confirm("Are you sure you want to delete this new arrival?")){l(!0);try{await y.mutateAsync(s)}catch{}finally{l(!1)}}};return o?e.jsx(x,{children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})})}):!i||i.role!=="admin"?null:g?e.jsx(x,{children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})})}):f?e.jsx(x,{children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"text-red-500",children:"Error loading new arrivals. Please try refreshing the page."})})}):e.jsx(x,{children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"New Arrivals"}),e.jsx(p,{to:"/admin/new-arrivals/new",className:"bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition duration-300",children:"Add New Arrival"})]}),(n==null?void 0:n.length)===0?e.jsx("div",{className:"bg-white shadow-md rounded-lg p-6 text-center",children:e.jsx("p",{className:"text-gray-500",children:"No new arrivals found. Add your first new arrival!"})}):e.jsx("div",{className:"bg-white shadow-md rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Image"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Price"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Category"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created At"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:n==null?void 0:n.map(s=>{var t;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:e.jsx("img",{className:"h-10 w-10 rounded-full object-cover",src:s.image||"https://placehold.co/100x100?text=No+Image",alt:s.name})})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.name})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"text-sm text-gray-900",children:["$",((t=s.price)==null?void 0:t.toFixed(2))||"0.00"]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:s.category||"N/A"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:L(s.createdAt)})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:[e.jsx(p,{to:`/admin/new-arrivals/${s._id}/edit`,className:"text-indigo-600 hover:text-indigo-900 mr-4",children:"Edit"}),e.jsx("button",{onClick:()=>N(s._id),disabled:a,className:"text-red-600 hover:text-red-900",children:a?"Deleting...":"Delete"})]})]},s._id)})})]})})})]})})};export{I as default};
