import{j as e,P as _,S as J,F as U,o as T,i as p,k as y,G as V,I as z,J as B,y as K}from"./ui-B5PjYYeE.js";import{u as X,r as c,L as f}from"./vendor-qOmVjXE-.js";import{m as Y,u as H,c as d}from"./index-DBuhCPqP.js";import{u as L}from"./useMutation-MTKIpc2f.js";import{P as W,d as Z,u as ee,a as se}from"./productService-rVeuLpxN.js";const ie=()=>{const v=Y(),k=X(),[j,D]=c.useState(""),[r,n]=c.useState([]),[l,$]=c.useState("name"),[i,C]=c.useState("asc"),[o,P]=c.useState(1),[b,I]=c.useState(""),[x]=c.useState(10);c.useEffect(()=>{const s=localStorage.getItem("token"),t=JSON.parse(localStorage.getItem("user"));(!s||!t||t.role!=="admin")&&k("/login")},[k]);const{data:N,isLoading:S,error:A}=H({queryKey:["products","admin"],queryFn:async()=>await se({admin:!0}),staleTime:5*60*1e3,cacheTime:10*60*1e3}),E=L({mutationFn:Z,onSuccess:()=>{v.invalidateQueries(["products"]),d.success("Product deleted successfully"),n([])},onError:s=>{var a,m,F,M;let t="Error deleting product";((a=s.response)==null?void 0:a.status)===401?t="You are not authorized to delete products":((m=s.response)==null?void 0:m.status)===404?t="Product not found":(M=(F=s.response)==null?void 0:F.data)!=null&&M.message&&(t=s.response.data.message),d.error(t)}}),O=L({mutationFn:({id:s,data:t})=>ee(s,t),onSuccess:()=>{v.invalidateQueries(["products"]),d.success("Product updated successfully")},onError:s=>{var t,a;d.error(((a=(t=s.response)==null?void 0:t.data)==null?void 0:a.message)||"Error updating product")}}),u=(N==null?void 0:N.products)||[],Q=async s=>{if(window.confirm("Are you sure you want to delete this product?"))try{await E.mutateAsync(s)}catch{}},q=async()=>{if(r.length===0){d.error("Please select products to delete");return}if(window.confirm(`Are you sure you want to delete ${r.length} products?`))try{await Promise.all(r.map(s=>E.mutateAsync(s))),d.success("Selected products deleted successfully"),n([])}catch{}},h=s=>{s===l?C(i==="asc"?"desc":"asc"):($(s),C("asc"))},R=async s=>{try{await O.mutateAsync({id:s._id,data:{isActive:!s.isActive}})}catch{}},g=[...u.filter(s=>{if(!s||!s.name||!s.category)return!1;const t=s.name.toLowerCase().includes(j.toLowerCase())||s.category.toLowerCase().includes(j.toLowerCase()),a=!b||s.category===b;return t&&a})].sort((s,t)=>{const a=s[l],m=t[l];return i==="asc"?a>m?1:-1:a<m?1:-1}),w=Math.ceil(g.length/x),G=g.slice((o-1)*x,o*x);return S?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):A?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",role:"alert",children:[e.jsx("strong",{className:"font-bold",children:"Error: "}),e.jsx("span",{className:"block sm:inline",children:A.message})]})}):u.length===0&&!S?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mb-6 space-y-4 md:space-y-0",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Products Management"}),e.jsxs(f,{to:"/admin/products/new",className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200",children:[e.jsx(_,{className:"w-5 h-5 mr-2"}),"Add New Product"]})]}),e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"No products found. Add a new product to get started."})})]})}):e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mb-6 space-y-4 md:space-y-0",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Products Management"}),e.jsxs(f,{to:"/admin/products/new",className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200",children:[e.jsx(_,{className:"w-5 h-5 mr-2"}),"Add New Product"]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-grow",children:[e.jsx(J,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"Search products...",value:j,onChange:s=>D(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(U,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsxs("select",{value:b,onChange:s=>I(s.target.value),className:"pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent appearance-none bg-white",children:[e.jsx("option",{value:"",children:"All Categories"}),Object.values(W).map(s=>e.jsx("option",{value:s,children:s},s))]})]})]}),r.length>0&&e.jsx("div",{className:"mb-6",children:e.jsxs("button",{onClick:q,className:"inline-flex items-center px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors duration-200",children:[e.jsx(T,{className:"w-5 h-5 mr-2"}),"Delete Selected (",r.length,")"]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:e.jsx("input",{type:"checkbox",checked:r.length===u.length,onChange:s=>{s.target.checked?n(u.map(t=>t._id)):n([])},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",onClick:()=>h("name"),children:e.jsxs("div",{className:"flex items-center",children:["Name",l==="name"&&(i==="asc"?e.jsx(p,{className:"w-4 h-4 ml-1"}):e.jsx(y,{className:"w-4 h-4 ml-1"}))]})}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",onClick:()=>h("category"),children:e.jsxs("div",{className:"flex items-center",children:["Category",l==="category"&&(i==="asc"?e.jsx(p,{className:"w-4 h-4 ml-1"}):e.jsx(y,{className:"w-4 h-4 ml-1"}))]})}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",onClick:()=>h("price"),children:e.jsxs("div",{className:"flex items-center",children:["Price",l==="price"&&(i==="asc"?e.jsx(p,{className:"w-4 h-4 ml-1"}):e.jsx(y,{className:"w-4 h-4 ml-1"}))]})}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",onClick:()=>h("stock"),children:e.jsxs("div",{className:"flex items-center",children:["Stock",l==="stock"&&(i==="asc"?e.jsx(p,{className:"w-4 h-4 ml-1"}):e.jsx(y,{className:"w-4 h-4 ml-1"}))]})}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:G.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("input",{type:"checkbox",checked:r.includes(s._id),onChange:t=>{t.target.checked?n([...r,s._id]):n(r.filter(a=>a!==s._id))},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[s.image&&e.jsx("img",{src:s.image,alt:s.name,className:"h-10 w-10 rounded-full object-cover mr-3"}),e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.name})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800",children:s.category})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:["$",s.price.toFixed(2)]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${s.stock>10?"bg-green-100 text-green-800":s.stock>0?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:s.stock})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("button",{onClick:()=>R(s),className:`inline-flex items-center px-2.5 py-1.5 rounded-full text-xs font-medium ${s.isActive?"bg-green-100 text-green-800 hover:bg-green-200":"bg-red-100 text-red-800 hover:bg-red-200"}`,children:s.isActive?e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"w-4 h-4 mr-1"}),"Active"]}):e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"w-4 h-4 mr-1"}),"Inactive"]})})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(f,{to:`/admin/products/${s._id}/edit`,className:"text-blue-600 hover:text-blue-900",children:e.jsx(B,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>Q(s._id),className:"text-red-600 hover:text-red-900",children:e.jsx(T,{className:"w-5 h-5"})}),e.jsx(f,{to:`/products/${s._id}`,className:"text-gray-600 hover:text-gray-900",children:e.jsx(K,{className:"w-5 h-5"})})]})})]},s._id))})]})}),w>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Showing ",(o-1)*x+1," to ",Math.min(o*x,g.length)," of ",g.length," products"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>P(s=>Math.max(s-1,1)),disabled:o===1,className:"px-3 py-1 rounded-md bg-white border border-gray-300 text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),e.jsx("button",{onClick:()=>P(s=>Math.min(s+1,w)),disabled:o===w,className:"px-3 py-1 rounded-md bg-white border border-gray-300 text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]})]})})};export{ie as default};
